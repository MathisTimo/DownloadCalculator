<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Reaction test</title>
    <link rel="stylesheet" href="style.css">
    <link rel="icon" type="image/png" href="https://png.pngtree.com/element_our/md/20180427/md_5ae2bfcc6832a.png">
    <script src="jquery-3.3.1.min.js"></script>
    <script>
    
    var nbturn = 5;
    var turn = 0;
    var arr = [];
    var results = [];
    var st = null;
    var check = 0;
        

    function play(){
        if (turn < nbturn){
            red();
            console.log("Trun nb" + turn)
        }
        else{
            end();
        }
    }
    
    function red(){
        console.log("red")
        $( ".generate" ).remove();
        $('#dbody').append('<div class="generate" id="redscreen" onclick="toosoon()"><p class="bigtext">Click when the page<br>turn green</p></div>');
        var x = Math.floor((Math.random() * 4000) + 2000);
        var st = setTimeout(green, x);
    }
        
    function green(){
        console.log('WAIT')
        if(check == 0){
        console.log("green")
        $( ".generate" ).remove();
        $('#dbody').append('<div class="generate"  id="bluescreen" onclick="stop()"><p class="bigtext">Click now !</p></div>');
        start();
        }
        else{
            console.log('ELSE GREEN');
            check = 0;
        }
    }
        
    function start(){
    console.log("start")
	time_avant= Date.now();
	timer=setInterval(function() {time_ms=(Date.now()-time_avant);time_ms=(time_ms+"");});   
    }   
    
    function stop(){
        console.log("stop")
        clearInterval(timer);
        turn++;
        $( ".generate" ).remove();
        $('#dbody').append('<div class="generate" id="stopscreen" onclick="play()"><div id="divms"><center><table><tbody><tr><th><p class="ms" id="ms">000</p></th><th><p id="mstext">ms</p></th></tr></tbody></table></center><p id="conti">Click to continue</p></div></div>');
        document.getElementById("ms").innerHTML=time_ms;document;
        arr.push(time_ms);
    }
    function toosoon(){
        check = 1;
        $( ".generate" ).remove();
        $('#dbody').append('<div class="generate" id="toosoon" onclick="play()"><p class="bigtext"> Your clicked too soon</p><br><p class="line"> Click to try again</p></div>');
        
    }
        
    function end(){
        console.log('end');
        $( ".generate" ).remove();
        moyenne()
    }
        
    function moyenne(){
        for (var i=0,l=arr.length;i<l;i++) 
            results.push(+arr[i]);
        var moy = Math.round((results[0]+results[1]+results[2]+results[3]+results[4])/nbturn);
        console.log(moy);
        $('#dbody').append('<div id="endscreen"><p id="conti">You made an average of</p><center><table><tbody><tr><th><p class="ms" id="moy">000</p></th><th><p id="mstext">ms</p></th></tr></tbody></table></center></div>');
        document.getElementById("moy").innerHTML=moy;document;
    }
    
    </script>
  </head>
  <body id="dbody">
      <div id="h"></div>
      <div class="generate" id=ready onclick="play()">
          <div id="i1"><p id="are">ARE</p></div>
          <div id="i2"><p id="you">YOU</p></div>
          <div id="i3"><p id="reeady">READY ?</p></div>
          <div id="i4"><p id="sta">Click anywhere to start</p></div>
        <p class="bigtext"></p>
      </div>      
  </body>
</html>